{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/rashafaheem/Desktop/todo-app/src/app/%28protected%29/profile/profile-settings/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, ChangeEvent } from \"react\";\nimport { supabase } from \"../../../lib/supabase-client\";\nimport { useRouter } from \"next/navigation\";\nimport { User } from \"@supabase/supabase-js\";\n\nexport default function ProfileSettings() {\n  const router = useRouter();\n  const [user, setUser] = useState<User | null>(null);\n\n  // Form state\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [avatarUrl, setAvatarUrl] = useState<string | null>(null);\n\n  // Loading states\n  const [isUploading, setIsUploading] = useState(false);\n  const [isSaving, setIsSaving] = useState(false);\n\n  // Fetch user session\n  useEffect(() => {\n    const fetchUser = async () => {\n      const { data } = await supabase.auth.getUser();\n      if (!data.user) return;\n\n      setUser(data.user);\n      setName(data.user.user_metadata?.full_name || \"\");\n      setEmail(data.user.email || \"\");\n      setAvatarUrl(data.user.user_metadata?.avatar_url || null);\n    };\n\n    fetchUser();\n  }, []);\n\n  // Upload avatar\n  const uploadAvatar = async (file: File) => {\n    if (!file) return null;\n\n    const sanitizedFileName = file.name.replace(/\\s+/g, \"-\").replace(/[^a-zA-Z0-9-_.]/g, \"\");\n    const filePath = `avatars/${sanitizedFileName}`;\n\n    setIsUploading(true);\n\n    const { data, error } = await supabase.storage\n      .from(\"avatars\")\n      .upload(filePath, file, { upsert: true });\n\n    if (error) {\n      console.error(\"Avatar upload error:\", error.message);\n      setIsUploading(false);\n      return null;\n    }\n\n    const { data: publicData } = supabase.storage.from(\"avatars\").getPublicUrl(filePath);\n\n    setIsUploading(false);\n    return publicData.publicUrl;\n  };\n\n  // Handle avatar input change\n  const handleAvatarChange = async (e: ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files?.[0]) return;\n\n    const file = e.target.files[0];\n    const url = await uploadAvatar(file);\n    if (!url) return;\n\n    // Update user metadata in Supabase Auth\n    const { error } = await supabase.auth.updateUser({\n      data: { avatar_url: url, full_name: name },\n    });\n\n    if (error) {\n      console.error(\"Error updating avatar:\", error.message);\n      return;\n    }\n\n    setAvatarUrl(url);\n  };\n\n  // Handle profile update\n  const handleUpdateProfile = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n\n    setIsSaving(true);\n\n    // Update Supabase Auth\n    const { error: authError } = await supabase.auth.updateUser({\n      data: { full_name: name, avatar_url: avatarUrl },\n      email,\n    });\n\n    if (authError) {\n      console.error(\"Profile update error:\", authError.message);\n      setIsSaving(false);\n      return;\n    }\n\n    // Update Profiles table\n    const { error: dbError } = await supabase.from(\"Profiles\").upsert({\n      auth_id: user.id,\n      name,\n      avatar_url: avatarUrl,\n      email,\n    });\n\n    if (dbError) {\n      console.error(\"Database update error:\", dbError.message);\n      setIsSaving(false);\n      return;\n    }\n\n    setUser({\n      ...user,\n      email,\n      user_metadata: { full_name: name, avatar_url: avatarUrl },\n    });\n\n    setIsSaving(false);\n    alert(\"Profile updated successfully!\");\n  };\n\n  if (!user) return null;\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 p-4\">\n      <button\n        className=\"mb-4 px-3 py-1 bg-gray-200 rounded hover:bg-gray-300\"\n        onClick={() => router.push(\"/todos\")}\n      >\n        ‚Üê Back to Dashboard\n      </button>\n\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        <div className=\"bg-white p-6 rounded shadow\">\n          <h2 className=\"text-xl font-bold mb-4\">Profile Information</h2>\n\n          <div className=\"flex items-center gap-4 mb-4\">\n            <div className=\"w-20 h-20 rounded-full overflow-hidden bg-gray-300 flex items-center justify-center\">\n              {isUploading ? (\n                <span className=\"text-white font-bold text-center text-sm\">Uploading...</span>\n              ) : avatarUrl ? (\n                <img src={avatarUrl} alt=\"Avatar\" className=\"w-full h-full object-cover\" />\n              ) : (\n                <span className=\"text-2xl font-bold text-white\">\n                  {name ? name[0].toUpperCase() : email[0].toUpperCase()}\n                </span>\n              )}\n            </div>\n\n            <input\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleAvatarChange}\n              disabled={isUploading}\n            />\n          </div>\n\n          <form onSubmit={handleUpdateProfile} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Name</label>\n              <input\n                type=\"text\"\n                className=\"w-full border rounded p-2\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Email</label>\n              <input\n                type=\"email\"\n                className=\"w-full border rounded p-2\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n              />\n            </div>\n\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50\"\n              disabled={isSaving || isUploading}\n            >\n              {isSaving ? \"Saving...\" : \"Save Changes\"}\n            </button>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}