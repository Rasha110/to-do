{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/rashafaheem/Desktop/todo-app/src/app/%28protected%29/profile/profile-settings/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, ChangeEvent } from \"react\";\nimport { supabase } from \"@/app/lib/supabase-client\";\nimport router from \"next/router\";\nexport default function ProfileSettings() {\n  const [user, setUser] = useState<User | null>(null);\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [avatarUrl, setAvatarUrl] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  // \n  useEffect(() => {\n    const fetchUser = async () => {\n      const { data } = await supabase.auth.getUser();\n      if (!data.user) return; \n      setUser(data.user);\n      setName(data.user.user_metadata?.full_name || \"\");\n      setEmail(data.user.email || \"\");\n      setAvatarUrl(data.user.user_metadata?.avatar_url || null);\n    };\n    fetchUser();\n  }, []);\n\n  // Upload avatar image to Supabase Storage\n  const uploadAvatar = async (file: File) => {\n    const sanitizedFileName = file.name\n      .replace(/\\s+/g, \"-\")\n      .replace(/[^a-zA-Z0-9-_.]/g, \"\");\n    const filePath = `avatars/${sanitizedFileName}`;\n\n    const { data, error } = await supabase.storage\n      .from(\"avatars\")\n      .upload(filePath, file, { upsert: true });\n\n    if (error) {\n      console.error(\"Avatar upload error:\", error.message);\n      return null;\n    }\n\n    const { data: publicData } = supabase.storage\n      .from(\"avatars\")\n      .getPublicUrl(filePath);\n\n    return publicData.publicUrl;\n  };\n\n\n  const handleAvatarChange = async (e: ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files?.[0]) return;\n    const file = e.target.files[0];\n    const url = await uploadAvatar(file);\n    if (!url) return;\n\n    const { error } = await supabase.auth.updateUser({\n      data: { full_name: name, avatar_url: url },\n    });\n    if (error) {\n      console.error(\"Error updating avatar:\", error.message);\n      return;\n    }\n\n    setAvatarUrl(url);\n  };\n\n  //  Handle form \n  const handleUpdateProfile = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n\n    setIsLoading(true);\n\n    const { error: authError } = await supabase.auth.updateUser({\n      data: { full_name: name, avatar_url: avatarUrl },\n      email,\n    });\n\n    if (authError) {\n      console.error(\"Profile update error:\", authError.message);\n      setIsLoading(false);\n      return;\n    }\n\n    const { error: dbError } = await supabase.from(\"Profiles\").upsert({\n      auth_id: user.id,\n      name,\n      avatar_url: avatarUrl,\n      email,\n    });\n\n    if (dbError) {\n      console.error(\"Database update error:\", dbError.message);\n      setIsLoading(false);\n      return;\n    }\n\n    setUser({\n      ...user,\n      email,\n      user_metadata: { full_name: name, avatar_url: avatarUrl },\n    });\n    setIsLoading(false);\n    alert(\"Profile updated successfully!\");\n  };\n\n  if (!user) return null;\n\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 p-4\">\n        <button\n        className=\"mb-4 px-3 py-1 bg-gray-200 rounded hover:bg-gray-300\"\n        onClick={() => router.push(\"/todos\")}\n      >\n        ‚Üê Back to Dashboard\n      </button>\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        <div className=\"bg-white p-6 rounded shadow\">\n          <h2 className=\"text-xl font-bold mb-4\">Profile Information</h2>\n\n          <div className=\"flex items-center gap-4 mb-4\">\n            <div className=\"w-20 h-20 rounded-full overflow-hidden bg-gray-300 flex items-center justify-center\">\n              {avatarUrl ? (\n                <img\n                  src={avatarUrl}\n                  alt=\"Avatar\"\n                  className=\"w-full h-full object-cover\"\n                />\n              ) : (\n                <span className=\"text-2xl font-bold text-white\">\n                  {name ? name[0].toUpperCase() : email[0].toUpperCase()}\n                </span>\n              )}\n            </div>\n            <input type=\"file\" accept=\"image/*\" onChange={handleAvatarChange} />\n          </div>\n\n          <form onSubmit={handleUpdateProfile} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Name</label>\n              <input\n                type=\"text\"\n                className=\"w-full border rounded p-2\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Email</label>\n              <input\n                type=\"email\"\n                className=\"w-full border rounded p-2\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n              />\n            </div>\n\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50\"\n              disabled={isLoading}\n            >\n              {isLoading ? \"Saving...\" : \"Save Changes\"}\n            </button>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}