{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/rashafaheem/Desktop/todo-app/src/app/auth/profile-settings.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, ChangeEvent } from \"react\";\nimport { useRouter } from \"next/navigation\";\nimport { supabase } from \"@/lib/supabase-client\";\n\nexport default function ProfileSettings() {\n  const router = useRouter();\n  const [user, setUser] = useState<User | null>(null);\n    const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [avatarUrl, setAvatarUrl] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  useEffect(() => {\n    const fetchUser = async () => {\n      const { data } = await supabase.auth.getUser();\n      if (!data.user) {\n        router.push(\"/signin\");\n        return;\n      }\n\n      setUser(data.user);\n      setName(data.user.user_metadata?.full_name || \"\");\n      setEmail(data.user.email || \"\");\n      setAvatarUrl(data.user.user_metadata?.avatar_url || null);\n    };\n    fetchUser();\n  }, [router]);\n\n  const uploadAvatar = async (file: File) => {\n    if (!file) return null;\n  \n\n    const sanitizedFileName = file.name.replace(/\\s+/g, \"-\").replace(/[^a-zA-Z0-9-_.]/g, \"\");\n    const filePath = `avatars/${sanitizedFileName}`;\n  \n    const { data, error } = await supabase.storage\n      .from(\"avatars\")\n      .upload(filePath, file, { upsert: true });\n  \n    if (error) {\n      console.error(\"Avatar upload error:\", error.message);\n      return null;\n    }\n  \n    const { data: publicData } = supabase.storage.from(\"avatars\").getPublicUrl(filePath);\n    return publicData.publicUrl;\n  };\n  \n\n  const handleAvatarChange = async (e: ChangeEvent<HTMLInputElement>) => {\n    if (!e.target.files) return;\n    const file = e.target.files[0];\n\n    const url = await uploadAvatar(file);\n    if (!url) return;\n\n    // Update user metadata\n    const { error } = await supabase.auth.updateUser({\n      data: { full_name: name, avatar_url: url },\n    });\n    if (error) {\n      console.error(\"Error updating avatar:\", error.message);\n      return;\n    }\n\n    setAvatarUrl(url);\n  };\n\n  const handleUpdateProfile = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user) return;\n  \n    setIsLoading(true);\n  \n    // 1️Update Auth user metadata\n    const { error: authError } = await supabase.auth.updateUser({\n      data: { full_name: name, avatar_url: avatarUrl },\n      email,\n    });\n  \n    if (authError) {\n      console.error(\"Profile update error:\", authError.message);\n      setIsLoading(false);\n      return;\n    }\n  \n    // 2️ Upsert profile into Profiles table\n    const { error: dbError } = await supabase.from(\"Profiles\").upsert({\n        auth_id: user.id,\n        name,\n        avatar_url: avatarUrl,\n        email,\n      });\n      \n      \n  \n    if (dbError) {\n      console.error(\"Database update error:\", dbError.message);\n      setIsLoading(false);\n      return;\n    }\n  \n  \n    setUser({ ...user, email, user_metadata: { full_name: name, avatar_url: avatarUrl } });\n    setIsLoading(false);\n    alert(\"Profile updated successfully!\");\n  };\n  \n\n  if (!user) return null;\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 p-4\">\n      <button\n        className=\"mb-4 px-3 py-1 bg-gray-200 rounded hover:bg-gray-300\"\n        onClick={() => router.push(\"/todos\")}\n      >\n        ← Back to Dashboard\n      </button>\n\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        <div className=\"bg-white p-6 rounded shadow\">\n          <h2 className=\"text-xl font-bold mb-4\">Profile Information</h2>\n\n          <div className=\"flex items-center gap-4 mb-4\">\n            <div className=\"w-20 h-20 rounded-full overflow-hidden bg-gray-300 flex items-center justify-center\">\n              {avatarUrl ? (\n                <img src={avatarUrl} alt=\"Avatar\" className=\"w-full h-full object-cover\" />\n              ) : (\n                <span className=\"text-2xl font-bold text-white\">\n                  {name ? name[0].toUpperCase() : email[0].toUpperCase()}\n                </span>\n              )}\n            </div>\n            <input type=\"file\" accept=\"image/*\" onChange={handleAvatarChange} />\n          </div>\n\n          <form onSubmit={handleUpdateProfile} className=\"space-y-4\">\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Name</label>\n              <input\n                type=\"text\"\n                className=\"w-full border rounded p-2\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n              />\n            </div>\n            <div>\n              <label className=\"block text-sm font-medium mb-1\">Email</label>\n              <input\n                type=\"email\"\n                className=\"w-full border rounded p-2\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n              />\n            </div>\n            <button\n              type=\"submit\"\n              className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50\"\n              disabled={isLoading}\n            >\n              {isLoading ? \"Saving...\" : \"Save Changes\"}\n            </button>\n          </form>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}